

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fitting (LiveFit) &mdash; ibex_bluesky_core 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=dc476284" />

  
    <link rel="shortcut icon" href="../../_static/favicon.svg"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Saving fit results to file (LiveFitLogger)" href="livefit_logger.html" />
    <link rel="prev" title="Chained Fitting (ChainedLiveFit)" href="chained_fitting.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ibex_bluesky_core
              <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/overview.html">Getting started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Devices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../devices/blocks.html">Blocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devices/dae.html">DAE (Data Acquisition Electronics)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Callbacks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../isiscallbacks.html">ISIS Standard Callbacks (<code class="xref py py-obj docutils literal notranslate"><span class="pre">ISISCallbacks</span></code>)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../fitting.html">Fits</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="chained_fitting.html">Chained Fitting (<code class="xref py py-obj docutils literal notranslate"><span class="pre">ChainedLiveFit</span></code>)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Fitting (<code class="xref py py-obj docutils literal notranslate"><span class="pre">LiveFit</span></code>)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#models">Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#standard-models">Standard Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-models">Custom Models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="livefit_logger.html">Saving fit results to file (<code class="xref py py-obj docutils literal notranslate"><span class="pre">LiveFitLogger</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="standard_fits.html">Standard Fitting Models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../centre_of_mass.html">Centre of Mass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../file_writing.html">File writing callbacks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Plans</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../plans/plans.html">General Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plans/reflectometry.html">Reflectometry-specific Plans</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Plan stubs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../plan_stubs/external_code.html">Calling external code (<code class="xref py py-obj docutils literal notranslate"><span class="pre">call_sync</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plan_stubs/matplotlib_helpers.html">Matplotlib helpers (<code class="xref py py-obj docutils literal notranslate"><span class="pre">call_qt_aware</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plan_stubs/plan_wrappers.html">Plan wrappers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plan_stubs/polling.html">Continuous polling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plan_stubs/redefining.html">Redefinition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plan_stubs/user_input.html">User input helpers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../replotting_scans.html">Replaying documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architectural_decisions.html">Architectural Decisions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_information.html">Developer Information</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ibex_bluesky_core</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../fitting.html">Fits</a></li>
      <li class="breadcrumb-item active">Fitting (<code class="xref py py-obj docutils literal notranslate"><span class="pre">LiveFit</span></code>)</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/ibex_bluesky_core/blob/main/doc/callbacks/fitting/fitting.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="fitting-livefit">
<h1>Fitting (<a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LiveFit</span></code></a>)<a class="headerlink" href="#fitting-livefit" title="Link to this heading"></a></h1>
<p>Similar to <a class="reference internal" href="../plotting.html"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">LivePlot</span></code></span></a>, <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ibex_bluesky_core.callbacks.LiveFit</span></code></a> provides a thin wrapper around Bluesky’s <a class="reference external" href="https://blueskyproject.io/bluesky/main/callbacks.html#bluesky.callbacks.LiveFit" title="(in bluesky v1.14.7.dev29+gfb2c32466)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bluesky.callbacks.LiveFit</span></code></a> class, enhancing it with additional functionality to better support real-time data fitting. This wrapper not only offers a wide selection of models to fit your data on, but also introduces guess generation for fit parameters. As new data points are acquired, the wrapper refines these guesses dynamically, improving the accuracy of the fit with each additional piece of data, allowing for more efficient and adaptive real-time fitting workflows.</p>
<p>In order to use the wrapper, import <code class="docutils literal notranslate"><span class="pre">LiveFit</span></code> is imported from <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ibex_bluesky_core.callbacks.LiveFit</span></code></a> rather than <a class="reference external" href="https://blueskyproject.io/bluesky/main/callbacks.html#bluesky.callbacks.LiveFit" title="(in bluesky v1.14.7.dev29+gfb2c32466)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bluesky.callbacks.LiveFit</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveFit</span>
</pre></div>
</div>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<p>Below is a full example showing how to use standard <a class="reference external" href="https://matplotlib.org/stable/index.html" title="(in Matplotlib v3.10.8)"><span class="xref std std-doc">matplotlib</span></a> &amp; <a class="reference external" href="https://blueskyproject.io/bluesky/main/index.html" title="(in bluesky v1.14.7.dev29+gfb2c32466)"><span class="xref std std-doc">bluesky</span></a> functionality to apply fitting to a scan, using <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LivePlot" title="ibex_bluesky_core.callbacks.LivePlot"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LivePlot</span></code></a> and <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LiveFit</span></code></a>. The fitting callback is set to expect data to take the form of a Gaussian, using the <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#ibex_bluesky_core.fitting.Gaussian" title="ibex_bluesky_core.fitting.Gaussian"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Gaussian</span></code></a> model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveFit</span><span class="p">,</span> <span class="n">LivePlot</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gaussian</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bluesky.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveFitPlot</span>

<span class="c1"># Create a new figure to plot onto.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="c1"># Make a new set of axes on that figure</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span> 
<span class="c1"># ax is shared by fit_callback and plot_callback </span>

<span class="n">plot_callback</span> <span class="o">=</span> <span class="n">LivePlot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="s2">&quot;yerr_signal&quot;</span><span class="p">)</span>
<span class="n">fit_callback</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">Gaussian</span><span class="o">.</span><span class="n">fit</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="s2">&quot;yerr_signal&quot;</span><span class="p">,</span> <span class="n">update_every</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># Using the yerr parameter allows you to use error bars.</span>
<span class="c1"># update_every = in seconds, how often to recompute the fit. </span>
<span class="c1">#   If `None`, do not compute until the end. Default is 1.</span>
<span class="n">fit_plot_callback</span> <span class="o">=</span> <span class="n">LiveFitPlot</span><span class="p">(</span><span class="n">fit_callback</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LiveFit</span></code></a> callback doesn’t perform plotting. It will return fitted parameters; a <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LiveFit</span></code></a> object must be passed to <a class="reference external" href="https://blueskyproject.io/bluesky/main/callbacks.html#bluesky.callbacks.mpl_plotting.LiveFitPlot" title="(in bluesky v1.14.7.dev29+gfb2c32466)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bluesky.callbacks.mpl_plotting.LiveFitPlot</span></code></a> in order to plot.</p>
</div>
<p>Using the <code class="docutils literal notranslate"><span class="pre">yerr</span></code> argument allows you to pass uncertainties via a signal to LiveFit, so that the “weight” of each point influences the fit produced. By not providing a signal name you choose not to use uncertainties/weighting in the fitting calculation. Each weight is computed as <code class="docutils literal notranslate"><span class="pre">1/(standard</span> <span class="pre">deviation</span> <span class="pre">at</span> <span class="pre">point)</span></code> and is taken into account to determine how much a point affects the overall fit of the data. Same as the rest of <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LiveFit</span></code></a>, the fit will be updated after every new point collected now taking into account the weights of each point. Uncertainty data is collected from Bluesky event documents after each new point.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">plot_callback</span></code> and <code class="docutils literal notranslate"><span class="pre">fit_plot_callback</span></code> objects can then be subscribed to the <code class="docutils literal notranslate"><span class="pre">RunEngine</span></code>, for example using <a class="reference external" href="https://blueskyproject.io/bluesky/main/generated/bluesky.preprocessors.subs_decorator.html#bluesky.preprocessors.subs_decorator" title="(in bluesky v1.14.7.dev29+gfb2c32466)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">subs_decorator</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bluesky.preprocessors</span><span class="w"> </span><span class="kn">import</span> <span class="n">subs_decorator</span>


<span class="nd">@subs_decorator</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">fit_plot_callback</span><span class="p">,</span>
        <span class="n">plot_callback</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plan</span><span class="p">():</span>
   <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="models">
<h2>Models<a class="headerlink" href="#models" title="Link to this heading"></a></h2>
<p>We support <strong>standard fits</strong> for the following trends in data. See <a class="reference internal" href="standard_fits.html"><span class="std std-doc">Standard Fits</span></a> for more information on the behaviour of these fits.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Trend</p></th>
<th class="head"><p>Class Name in <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#module-ibex_bluesky_core.fitting" title="ibex_bluesky_core.fitting"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ibex_bluesky_core.fitting</span></code></a></p></th>
<th class="head"><p>Arguments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Linear</p></td>
<td><p><a class="reference internal" href="standard_fits.html#fit-linear"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">Linear</span></code></span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Polynomial</p></td>
<td><p><a class="reference internal" href="standard_fits.html#fit-polynomial"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">Polynomial</span></code></span></a></p></td>
<td><p>Polynomial Degree (int)</p></td>
</tr>
<tr class="row-even"><td><p>Gaussian</p></td>
<td><p><a class="reference internal" href="standard_fits.html#fit-gaussian"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">Gaussian</span></code></span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Lorentzian</p></td>
<td><p><a class="reference internal" href="standard_fits.html#fit-lorentzian"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">Lorentzian</span></code></span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Damped Oscillator</p></td>
<td><p><a class="reference internal" href="standard_fits.html#fit-damped-osc"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">DampedOsc</span></code></span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Slit Scan Fit</p></td>
<td><p><a class="reference internal" href="standard_fits.html#fit-slitscan"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">SlitScan</span></code></span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Error Function</p></td>
<td><p><a class="reference internal" href="standard_fits.html#fit-erf"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">ERF</span></code></span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Complementary Error Function</p></td>
<td><p><a class="reference internal" href="standard_fits.html#fit-erfc"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">ERFC</span></code></span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Top Hat</p></td>
<td><p><a class="reference internal" href="standard_fits.html#fit-tophat"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">TopHat</span></code></span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Trapezoid</p></td>
<td><p><a class="reference internal" href="standard_fits.html#fit-trapezoid"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">Trapezoid</span></code></span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Negative Trapezoid</p></td>
<td><p><a class="reference internal" href="standard_fits.html#fit-neg-trapezoid"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">NegativeTrapezoid</span></code></span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Muon Momentum</p></td>
<td><p><a class="reference internal" href="standard_fits.html#fit-muon-momentum"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">MuonMomentum</span></code></span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>PeakStats (COM) <strong>*</strong></p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
</tbody>
</table>
<p>Bluesky additionally provides a <a class="reference external" href="https://blueskyproject.io/bluesky/main/callbacks.html#bluesky.callbacks.fitting.PeakStats" title="(in bluesky v1.14.7.dev29+gfb2c32466)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bluesky.callbacks.fitting.PeakStats</span></code></a> callback which computes peak statistics after a run finishes. Similar to <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LiveFit</span></code></a>, <a class="reference external" href="https://blueskyproject.io/bluesky/main/callbacks.html#bluesky.callbacks.fitting.PeakStats" title="(in bluesky v1.14.7.dev29+gfb2c32466)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PeakStats</span></code></a> does not plot by itself. The <a class="reference external" href="https://blueskyproject.io/bluesky/main/callbacks.html#bluesky.callbacks.mpl_plotting.plot_peak_stats" title="(in bluesky v1.14.7.dev29+gfb2c32466)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot_peak_stats</span></code></a> function can be used to draw results of a <a class="reference external" href="https://blueskyproject.io/bluesky/main/callbacks.html#bluesky.callbacks.fitting.PeakStats" title="(in bluesky v1.14.7.dev29+gfb2c32466)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PeakStats</span></code></a> on a plot.</p>
<hr class="docutils" />
<p>Each of the above fit classes has a <code class="docutils literal notranslate"><span class="pre">.fit()</span></code> which returns an object of type <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#ibex_bluesky_core.fitting.FitMethod" title="ibex_bluesky_core.fitting.FitMethod"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FitMethod</span></code></a>. This tells <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LiveFit</span></code></a> how to perform fitting on the data.</p>
<p>There are <em>two</em> ways that you can choose how to fit a model to your data:</p>
</section>
<section id="standard-models">
<h2>Standard Models<a class="headerlink" href="#standard-models" title="Link to this heading"></a></h2>
<p>When only using the standard fits provided by the <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#module-ibex_bluesky_core.fitting" title="ibex_bluesky_core.fitting"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ibex_bluesky_core.fitting</span></code></a> module, the following syntax can be used, replacing <code class="docutils literal notranslate"><span class="pre">[FIT]</span></code> with your chosen model from <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#module-ibex_bluesky_core.fitting" title="ibex_bluesky_core.fitting"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ibex_bluesky_core.fitting</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bluesky.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveFitPlot</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="p">[</span><span class="n">FIT</span><span class="p">]</span>

<span class="c1"># Pass [FIT].fit() to the first parameter of LiveFit</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">([</span><span class="n">FIT</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">update_every</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Then subscribe to LiveFitPlot(lf, ...)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">[FIT].fit()</span></code> function will pass the <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#ibex_bluesky_core.fitting.FitMethod" title="ibex_bluesky_core.fitting.FitMethod"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FitMethod</span></code></a> object straight to the <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LiveFit</span></code></a> class.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For the fits in the above table that require parameters, you will need to pass value(s) to their <code class="docutils literal notranslate"><span class="pre">.fit</span></code> method. For example, for a <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#ibex_bluesky_core.fitting.Polynomial" title="ibex_bluesky_core.fitting.Polynomial"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Polynomial</span></code></a> model:</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># For a polynomial of degree 3</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">Polynomial</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>  <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">update_every</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="custom-models">
<h2>Custom Models<a class="headerlink" href="#custom-models" title="Link to this heading"></a></h2>
<p>If you wish, you can define your own non-standard <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#ibex_bluesky_core.fitting.FitMethod" title="ibex_bluesky_core.fitting.FitMethod"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FitMethod</span></code></a> object. The <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#ibex_bluesky_core.fitting.FitMethod" title="ibex_bluesky_core.fitting.FitMethod"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FitMethod</span></code></a> class takes two function arguments as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model</span></code></p>
<ul>
<li><p>A function representing the behaviour of the model.</p></li>
<li><p>Returns the <code class="docutils literal notranslate"><span class="pre">y</span></code> value (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>) at the given <code class="docutils literal notranslate"><span class="pre">x</span></code> value and model parameters.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">guess</span></code></p>
<ul>
<li><p>A function that must take two <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.4)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> arrays, representing <code class="docutils literal notranslate"><span class="pre">x</span></code> data and respective <code class="docutils literal notranslate"><span class="pre">y</span></code> data, of type <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> as arguments and must return a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a> with <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a> keys and <a class="reference external" href="https://lmfit.github.io/lmfit-py/parameters.html#lmfit.parameter.Parameter" title="(in lmfit v1.3.4)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">lmfit.parameter.Parameter</span></code></a> values.</p></li>
<li><p>This will be called to guess a set of initial values for the fit, given the data already collected in the bluesky run.</p></li>
</ul>
</li>
</ul>
<p>See the following example on how to define these.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Linear Fitting</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">npt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lmfit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="n">FitMethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveFit</span>

<span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c0</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    
    <span class="k">return</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c0</span> <span class="c1"># y = mx + c</span>

<span class="k">def</span><span class="w"> </span><span class="nf">guess</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameter</span><span class="p">]:</span>

    <span class="c1"># Linear regression calculation</span>
    <span class="c1"># x = set of x data</span>
    <span class="c1"># y = set of respective y data</span>
    <span class="c1"># x[n] makes a pair with y[n]</span>
    
    <span class="n">numerator</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="n">c1</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">c1</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">init_guess</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;c1&quot;</span><span class="p">:</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="p">),</span> <span class="c1"># gradient</span>
        <span class="s2">&quot;c0&quot;</span><span class="p">:</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;c0&quot;</span><span class="p">,</span> <span class="n">c0</span><span class="p">),</span> <span class="c1"># y - intercept</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">init_guess</span>

<span class="n">fit_method</span> <span class="o">=</span> <span class="n">FitMethod</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span> 
<span class="c1">#Pass the model and guess function to FitMethod</span>

<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">fit_method</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">update_every</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Then subscribe to LiveFitPlot(lf, ...)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The parameters returned from the guess function must allocate to the arguments to the model function, ignoring the independent variable e.g <code class="docutils literal notranslate"><span class="pre">x</span></code> in this case. Array-like structures are not allowed. See the <a class="reference external" href="https://lmfit.github.io/lmfit-py/parameters.html" title="(in lmfit v1.3.4)"><span>Parameter and Parameters</span></a> for more information.</p>
</div>
<p>Each <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#ibex_bluesky_core.fitting.FitMethod" title="ibex_bluesky_core.fitting.FitMethod"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FitMethod</span></code></a> in <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#module-ibex_bluesky_core.fitting" title="ibex_bluesky_core.fitting"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ibex_bluesky_core.fitting</span></code></a> has a <code class="docutils literal notranslate"><span class="pre">.model()</span></code> and <code class="docutils literal notranslate"><span class="pre">.guess()</span></code>, which make up their fitting method. These are publicly accessible class methods.</p>
<p>This means that as long as the parameters returned from the guess function match to the arguments of the model, you may mix and match user-defined and standard models and guess functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveFit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="n">FitMethod</span><span class="p">,</span> <span class="n">Linear</span>


<span class="k">def</span><span class="w"> </span><span class="nf">different_model</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c0</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c0</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># y = mx + (c ** 2)</span>


<span class="n">fit_method</span> <span class="o">=</span> <span class="n">FitMethod</span><span class="p">(</span><span class="n">different_model</span><span class="p">,</span> <span class="n">Linear</span><span class="o">.</span><span class="n">guess</span><span class="p">())</span>
<span class="c1"># Uses the user defined model and the standard Guessing. function for linear models</span>

<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">fit_method</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">update_every</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Then subscribe to LiveFitPlot(lf, ...)</span>
</pre></div>
</div>
<p>Or the other way round …</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">lmfit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveFit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="n">FitMethod</span><span class="p">,</span> <span class="n">Linear</span>


<span class="c1"># This Guessing. function isn&#39;t very good because it&#39;s return values don&#39;t change on the data already collected in the Bluesky run</span>
<span class="c1"># It always guesses that the linear function is y = x</span>

<span class="k">def</span><span class="w"> </span><span class="nf">different_guess</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c0</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">init_guess</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s2">&quot;c1&quot;</span><span class="p">:</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># gradient</span>
      <span class="s2">&quot;c0&quot;</span><span class="p">:</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;c0&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># y - intercept</span>
    <span class="p">}</span>
  
    <span class="k">return</span> <span class="n">init_guess</span>


<span class="n">fit_method</span> <span class="o">=</span> <span class="n">FitMethod</span><span class="p">(</span><span class="n">Linear</span><span class="o">.</span><span class="n">model</span><span class="p">(),</span> <span class="n">different_guess</span><span class="p">)</span>
<span class="c1"># Uses the standard linear model and the user defined Guessing. function</span>

<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">fit_method</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">update_every</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Then subscribe to LiveFitPlot(lf, ...)</span>
</pre></div>
</div>
<p>Or you can create a completely user-defined fitting method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For fits that require arguments, you will need to pass values to their respective <code class="docutils literal notranslate"><span class="pre">.model</span></code> and <code class="docutils literal notranslate"><span class="pre">.guess</span></code> functions. E.g for <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#ibex_bluesky_core.fitting.Polynomial" title="ibex_bluesky_core.fitting.Polynomial"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Polynomial</span></code></a> fitting:</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit_method</span> <span class="o">=</span> <span class="n">FitMethod</span><span class="p">(</span><span class="n">Polynomial</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">different_guess</span><span class="p">)</span> <span class="c1"># If using a custom guess function</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">fit_method</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="chained_fitting.html" class="btn btn-neutral float-left" title="Chained Fitting (ChainedLiveFit)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="livefit_logger.html" class="btn btn-neutral float-right" title="Saving fit results to file (LiveFitLogger)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>