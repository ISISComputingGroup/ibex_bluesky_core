

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fitting (LiveFit) &mdash; ibex_bluesky_core 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=dc476284" />

  
    <link rel="shortcut icon" href="../../_static/favicon.svg"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Saving fit results to file (LiveFitLogger)" href="livefit_logger.html" />
    <link rel="prev" title="Chained Fitting (ChainedLiveFit)" href="chained_fitting.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ibex_bluesky_core
              <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/overview.html">Getting started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Devices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../devices/blocks.html">Blocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devices/dae.html">DAE (Data Acquisition Electronics)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Callbacks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../isiscallbacks.html">ISIS Standard Callbacks (<code class="xref py py-obj docutils literal notranslate"><span class="pre">ISISCallbacks</span></code>)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../fitting.html">Fits</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="chained_fitting.html">Chained Fitting (<code class="docutils literal notranslate"><span class="pre">ChainedLiveFit</span></code>)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Fitting (<code class="docutils literal notranslate"><span class="pre">LiveFit</span></code>)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#models">Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#option-1-use-the-standard-fits">Option 1: Use the standard fits</a></li>
<li class="toctree-l4"><a class="reference internal" href="#option-2-use-custom-fits">Option 2: Use custom fits</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="livefit_logger.html">Saving fit results to file (<code class="docutils literal notranslate"><span class="pre">LiveFitLogger</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="standard_fits.html">Standard Fitting Models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../centre_of_mass.html">Centre of Mass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../file_writing.html">File writing callbacks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Plans</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../plans/plans.html">General Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plans/reflectometry.html">Reflectometry-specific Plans</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Plan stubs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../plan_stubs/external_code.html"><code class="docutils literal notranslate"><span class="pre">call_sync</span></code> (calling external code)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plan_stubs/matplotlib_helpers.html"><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">call_qt_aware</span></code></span> (matplotlib helpers)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plan_stubs/polling.html">Continuous polling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plan_stubs/redefining.html">Redefinition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plan_stubs/user_input.html">User input helpers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architectural_decisions.html">Architectural Decisions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_information.html">Developer Information</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ibex_bluesky_core</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../fitting.html">Fits</a></li>
      <li class="breadcrumb-item active">Fitting (<code class="docutils literal notranslate"><span class="pre">LiveFit</span></code>)</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/ibex_bluesky_core/blob/main/doc/callbacks/fitting/fitting.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="fitting-livefit">
<h1>Fitting (<code class="docutils literal notranslate"><span class="pre">LiveFit</span></code>)<a class="headerlink" href="#fitting-livefit" title="Link to this heading"></a></h1>
<p>Similar to <a class="reference internal" href="../plotting.html"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">LivePlot</span></code></span></a>, <a class="reference internal" href="../../generated/ibex_bluesky_core.html#module-ibex_bluesky_core" title="ibex_bluesky_core"><span class="xref myst py py-mod"><code class="docutils literal notranslate"><span class="pre">ibex_bluesky_core</span></code></span></a> provides a thin wrapper around Bluesky’s <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">LiveFit</span></code></span></a> class, enhancing it with additional functionality to better support real-time data fitting. This wrapper not only offers a wide selection of models to fit your data on, but also introduces guess generation for fit parameters. As new data points are acquired, the wrapper refines these guesses dynamically, improving the accuracy of the fit with each additional piece of data, allowing for more efficient and adaptive real-time fitting workflows.</p>
<p>In order to use the wrapper, import <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">LiveFit</span></code></span></a> from <a class="reference internal" href="../../generated/ibex_bluesky_core.html#module-ibex_bluesky_core" title="ibex_bluesky_core"><span class="xref myst py py-mod"><code class="docutils literal notranslate"><span class="pre">ibex_bluesky_core</span></code></span></a> rather than
<code class="docutils literal notranslate"><span class="pre">bluesky</span></code> directly:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.callbacks.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveFit</span>
</pre></div>
</div>
<p>.. note::
that you do not <em>need</em> <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LivePlot" title="ibex_bluesky_core.callbacks.LivePlot"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">LivePlot</span></code></span></a>  for <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">LiveFit</span></code></span></a> to work but it may be useful to know visaully how well the model fits to the raw data.</p>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<p>Below is a full example showing how to use standard <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">bluesky</span></code> functionality to apply fitting to a scan, using LivePlot and LiveFit. The fitting callback is set to expect data to take the form of a gaussian.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveFit</span><span class="p">,</span> <span class="n">LivePlot</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gaussian</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bluesky.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveFitPlot</span>

<span class="c1"># Create a new figure to plot onto.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="c1"># Make a new set of axes on that figure</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span> 
<span class="c1"># ax is shared by fit_callback and plot_callback </span>

<span class="n">plot_callback</span> <span class="o">=</span> <span class="n">LivePlot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="s2">&quot;yerr_signal&quot;</span><span class="p">)</span>
<span class="n">fit_callback</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">Gaussian</span><span class="o">.</span><span class="n">fit</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="s2">&quot;yerr_signal&quot;</span><span class="p">,</span> <span class="n">update_every</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># Using the yerr parameter allows you to use error bars.</span>
<span class="c1"># update_every = in seconds, how often to recompute the fit. If `None`, do not compute until the end. Default is 1.</span>
<span class="n">fit_plot_callback</span> <span class="o">=</span> <span class="n">LiveFitPlot</span><span class="p">(</span><span class="n">fit_callback</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>.. note::
that the <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">LiveFit</span></code></span></a> callback doesn’t directly do the plotting, it will return function parameters of the model its trying to fit to; a <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">LiveFit</span></code></span></a> object must be passed to <code class="docutils literal notranslate"><span class="pre">LiveFitPlot</span></code> which can then be subscribed to the <code class="docutils literal notranslate"><span class="pre">RunEngine</span></code>. See the <a class="reference external" href="https://blueskyproject.io/bluesky/main/callbacks.html#livefitplot">Bluesky Documentation</a> for information on the various arguments that can be passed to the <code class="docutils literal notranslate"><span class="pre">LiveFitPlot</span></code> class.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">yerr</span></code> argument allows you to pass uncertainties via a signal to LiveFit, so that the “weight” of each point influences the fit produced. By not providing a signal name you choose not to use uncertainties/weighting in the fitting calculation. Each weight is computed as <code class="docutils literal notranslate"><span class="pre">1/(standard</span> <span class="pre">deviation</span> <span class="pre">at</span> <span class="pre">point)</span></code> and is taken into account to determine how much a point affects the overall fit of the data. Same as the rest of <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">LiveFit</span></code></span></a>, the fit will be updated after every new point collected now taking into account the weights of each point. Uncertainty data is collected from Bluesky event documents after each new point.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">plot_callback</span></code> and <code class="docutils literal notranslate"><span class="pre">fit_plot_callback</span></code> objects can then be subscribed to the <code class="docutils literal notranslate"><span class="pre">RunEngine</span></code>, using the same methods as described in <a class="reference internal" href="../plotting.html"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">LivePlot</span></code></span></a>. See the following example using <code class="docutils literal notranslate"><span class="pre">&#64;subs_decorator</span></code>:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@subs_decorator</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">fit_plot_callback</span><span class="p">,</span>
        <span class="n">plot_callback</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plan</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="o">...</span> 
</pre></div>
</div>
</section>
<section id="models">
<h2>Models<a class="headerlink" href="#models" title="Link to this heading"></a></h2>
<p>We support <strong>standard fits</strong> for the following trends in data. See <a class="reference internal" href="standard_fits.html"><span class="std std-doc">Standard Fits</span></a> for more infomation on the behaviour of these fits.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Trend</p></th>
<th class="head"><p>Class Name in <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#module-ibex_bluesky_core.fitting" title="ibex_bluesky_core.fitting"><span class="xref myst py py-mod"><code class="docutils literal notranslate"><span class="pre">fitting</span></code></span></a></p></th>
<th class="head"><p>Arguments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Linear</p></td>
<td><p><a class="reference internal" href="standard_fits.html#linear"><span class="std std-ref">Linear</span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Polynomial</p></td>
<td><p><a class="reference internal" href="standard_fits.html#polynomial"><span class="std std-ref">Polynomial</span></a></p></td>
<td><p>Polynomial Degree (int)</p></td>
</tr>
<tr class="row-even"><td><p>Gaussian</p></td>
<td><p><a class="reference internal" href="standard_fits.html#gaussian"><span class="std std-ref">Gaussian</span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Lorentzian</p></td>
<td><p><a class="reference internal" href="standard_fits.html#lorentzian"><span class="std std-ref">Lorentzian</span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Damped Oscillator</p></td>
<td><p><a class="reference internal" href="standard_fits.html#damped-oscillator-dampedosc"><span class="std std-ref">DampedOsc</span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Slit Scan Fit</p></td>
<td><p><a class="reference internal" href="standard_fits.html#slit-scan-slitscan"><span class="std std-ref">SlitScan</span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Error Function</p></td>
<td><p><a class="reference internal" href="standard_fits.html#error-function-erf"><span class="std std-ref">ERF</span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Complementary Error Function</p></td>
<td><p><a class="reference internal" href="standard_fits.html#complementary-error-function-erfc"><span class="std std-ref">ERFC</span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Top Hat</p></td>
<td><p><a class="reference internal" href="standard_fits.html#top-hat-tophat"><span class="std std-ref">TopHat</span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Trapezoid</p></td>
<td><p><a class="reference internal" href="standard_fits.html#trapezoid"><span class="std std-ref">Trapezoid</span></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>PeakStats (COM) <strong>*</strong></p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
</tbody>
</table>
<p>* Native to Bluesky there is support for <code class="docutils literal notranslate"><span class="pre">PeakStats</span></code> which “computes peak statsitics after a run finishes.” See <a class="reference external" href="https://blueskyproject.io/bluesky/main/callbacks.html#peakstats">Bluesky docs</a> for more information on this. Similar to <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">LiveFit</span></code></span></a> and <code class="docutils literal notranslate"><span class="pre">LiveFitPLot</span></code>, <code class="docutils literal notranslate"><span class="pre">PeakStats</span></code> is a callback and must be passed to <code class="docutils literal notranslate"><span class="pre">PeakStatsPlot</span></code> to be plotted on a set of axes, which is subscribed to by the <code class="docutils literal notranslate"><span class="pre">RunEngine</span></code>.</p>
<hr class="docutils" />
<p>Each of the above fit classes has a <code class="docutils literal notranslate"><span class="pre">.fit()</span></code> which returns an object of type <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#ibex_bluesky_core.fitting.FitMethod" title="ibex_bluesky_core.fitting.FitMethod"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">FitMethod</span></code></span></a>. This tells <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">LiveFit</span></code></span></a> how to perform fitting on the data. <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#ibex_bluesky_core.fitting.FitMethod" title="ibex_bluesky_core.fitting.FitMethod"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">FitMethod</span></code></span></a> is defined in <code class="docutils literal notranslate"><span class="pre">ibex_bluesky_core.fitting</span></code>.</p>
<p>There are <em>two</em> ways that you can choose how to fit a model to your data:</p>
<section id="option-1-use-the-standard-fits">
<h3>Option 1: Use the standard fits<a class="headerlink" href="#option-1-use-the-standard-fits" title="Link to this heading"></a></h3>
<p>When only using the standard fits provided by <a class="reference internal" href="../../generated/ibex_bluesky_core.html#module-ibex_bluesky_core" title="ibex_bluesky_core"><span class="xref myst py py-mod"><code class="docutils literal notranslate"><span class="pre">ibex_bluesky_core</span></code></span></a>, the following syntax can be used, replacing <code class="docutils literal notranslate"><span class="pre">[FIT]</span></code> with your chosen one from <code class="docutils literal notranslate"><span class="pre">ibex_bluesky_core.fitting</span></code>:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bluesky.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveFitPlot</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="p">[</span><span class="n">FIT</span><span class="p">]</span>

<span class="c1"># Pass [FIT].fit() to the first parameter of LiveFit</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">([</span><span class="n">FIT</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">update_every</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Then subscribe to LiveFitPlot(lf, ...)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">[FIT].fit()</span></code> function will pass the <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#ibex_bluesky_core.fitting.FitMethod" title="ibex_bluesky_core.fitting.FitMethod"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">FitMethod</span></code></span></a> object straight to the <a class="reference internal" href="../../generated/ibex_bluesky_core.callbacks.html#ibex_bluesky_core.callbacks.LiveFit" title="ibex_bluesky_core.callbacks.LiveFit"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">LiveFit</span></code></span></a> class.</p>
<p>.. note::
that for the fits in the above table that require parameters, you will need to pass value(s) to their <code class="docutils literal notranslate"><span class="pre">.fit</span></code> method. For example Polynomial fitting:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">Polynomial</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>  <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">update_every</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># For a polynomial of degree 3</span>
</pre></div>
</div>
</section>
<section id="option-2-use-custom-fits">
<h3>Option 2: Use custom fits<a class="headerlink" href="#option-2-use-custom-fits" title="Link to this heading"></a></h3>
<p>If you wish, you can define your own non-standard <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#ibex_bluesky_core.fitting.FitMethod" title="ibex_bluesky_core.fitting.FitMethod"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">FitMethod</span></code></span></a> object. The <a class="reference internal" href="../../generated/ibex_bluesky_core.fitting.html#ibex_bluesky_core.fitting.FitMethod" title="ibex_bluesky_core.fitting.FitMethod"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">FitMethod</span></code></span></a> class takes two function arguments as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model</span></code></p>
<ul>
<li><p>A function representing the behaviour of the model.</p></li>
<li><p>Returns the <code class="docutils literal notranslate"><span class="pre">y</span></code> value (<code class="docutils literal notranslate"><span class="pre">float</span></code>) at the given <code class="docutils literal notranslate"><span class="pre">x</span></code> value and model parameters.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">guess</span></code></p>
<ul>
<li><p>A function that must take two <code class="docutils literal notranslate"><span class="pre">np.array</span></code> arrays, representing <code class="docutils literal notranslate"><span class="pre">x</span></code> data and respective <code class="docutils literal notranslate"><span class="pre">y</span></code> data, of type <code class="docutils literal notranslate"><span class="pre">float</span></code> as arguments and must return a <code class="docutils literal notranslate"><span class="pre">dict</span></code> in the form <code class="docutils literal notranslate"><span class="pre">dict[str,</span> <span class="pre">lmfit.Parameter]</span></code>.</p></li>
<li><p>This will be called to guess the properties of the model, given the data already collected in the Bluesky run.</p></li>
</ul>
</li>
</ul>
<p>See the following example on how to define these.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># Linear Fitting</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lmfit</span>

<span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c0</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    
    <span class="k">return</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c0</span> <span class="c1"># y = mx + c</span>

<span class="k">def</span><span class="w"> </span><span class="nf">guess</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameter</span><span class="p">]:</span>

    <span class="c1"># Linear regression calculation</span>
    <span class="c1"># x = set of x data</span>
    <span class="c1"># y = set of respective y data</span>
    <span class="c1"># x[n] makes a pair with y[n]</span>
    
    <span class="n">numerator</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="n">c1</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">c1</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">init_guess</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;c1&quot;</span><span class="p">:</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="p">),</span> <span class="c1"># gradient</span>
        <span class="s2">&quot;c0&quot;</span><span class="p">:</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;c0&quot;</span><span class="p">,</span> <span class="n">c0</span><span class="p">),</span> <span class="c1"># y - intercept</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">init_guess</span>

<span class="n">fit_method</span> <span class="o">=</span> <span class="n">FitMethod</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span> 
<span class="c1">#Pass the model and guess function to FitMethod</span>

<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">fit_method</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">update_every</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Then subscribe to LiveFitPlot(lf, ...)</span>
</pre></div>
</div>
<p>.. note::
that the parameters returned from the guess function must allocate to the arguments to the model function, ignoring the independant variable e.g <code class="docutils literal notranslate"><span class="pre">x</span></code> in this case. Array-like structures are not allowed. See the <a class="reference external" href="https://lmfit.github.io/lmfit-py/parameters.html">lmfit documentation</a> for more information.</p>
<section id="option-2-continued">
<h4>Option 2: Continued<a class="headerlink" href="#option-2-continued" title="Link to this heading"></a></h4>
<p>Each <code class="docutils literal notranslate"><span class="pre">Fit</span></code> in <code class="docutils literal notranslate"><span class="pre">ibex_bluesky_core.callbacks.fitting</span></code> has a <code class="docutils literal notranslate"><span class="pre">.model()</span></code> and <code class="docutils literal notranslate"><span class="pre">.guess()</span></code>, which make up their fitting method. These are publically accessible class methods.</p>
<p>This means that aslong as the parameters returned from the guess function match to the arguments of the model function, you may mix and match user-made and standard, models and guess functions in the following manner:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">lmfit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveFit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="n">FitMethod</span><span class="p">,</span> <span class="n">Linear</span>


<span class="k">def</span><span class="w"> </span><span class="nf">different_model</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c0</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c0</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># y = mx + (c ** 2)</span>


<span class="n">fit_method</span> <span class="o">=</span> <span class="n">FitMethod</span><span class="p">(</span><span class="n">different_model</span><span class="p">,</span> <span class="n">Linear</span><span class="o">.</span><span class="n">guess</span><span class="p">())</span>
<span class="c1"># Uses the user defined model and the standard Guessing. function for linear models</span>

<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">fit_method</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">update_every</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Then subscribe to LiveFitPlot(lf, ...)</span>
</pre></div>
</div>
<p>… or the other way round …</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">lmfit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveFit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibex_bluesky_core.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="n">FitMethod</span><span class="p">,</span> <span class="n">Linear</span>


<span class="c1"># This Guessing. function isn&#39;t very good because it&#39;s return values don&#39;t change on the data already collected in the Bluesky run</span>
<span class="c1"># It always guesses that the linear function is y = x</span>

<span class="k">def</span><span class="w"> </span><span class="nf">different_guess</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c0</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">init_guess</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s2">&quot;c1&quot;</span><span class="p">:</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># gradient</span>
      <span class="s2">&quot;c0&quot;</span><span class="p">:</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;c0&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># y - intercept</span>
    <span class="p">}</span>
  
    <span class="k">return</span> <span class="n">init_guess</span>


<span class="n">fit_method</span> <span class="o">=</span> <span class="n">FitMethod</span><span class="p">(</span><span class="n">Linear</span><span class="o">.</span><span class="n">model</span><span class="p">(),</span> <span class="n">different_guess</span><span class="p">)</span>
<span class="c1"># Uses the standard linear model and the user defined Guessing. function</span>

<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">fit_method</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y_signal&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x_signal&quot;</span><span class="p">,</span> <span class="n">update_every</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Then subscribe to LiveFitPlot(lf, ...)</span>
</pre></div>
</div>
<p>Or you can create a completely user-defined fitting method.</p>
<p>.. note::
that for fits that require arguments, you will need to pass values to their respecitive <code class="docutils literal notranslate"><span class="pre">.model</span></code> and <code class="docutils literal notranslate"><span class="pre">.guess</span></code> functions. E.g for <code class="docutils literal notranslate"><span class="pre">Polynomial</span></code> fitting:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">fit_method</span> <span class="o">=</span> <span class="n">FitMethod</span><span class="p">(</span><span class="n">Polynomial</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">different_guess</span><span class="p">)</span> <span class="c1"># If using a custom guess function</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">fit_method</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="#models">standard fits</a> list above for standard fits which require parameters. It gets more complicated if you want to define your own custom model or guess which you want to pass parameters to. You will have to define a function that takes these parameters and returns the model / guess function with the subsituted values.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="chained_fitting.html" class="btn btn-neutral float-left" title="Chained Fitting (ChainedLiveFit)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="livefit_logger.html" class="btn btn-neutral float-right" title="Saving fit results to file (LiveFitLogger)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>